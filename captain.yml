# Builder image
# Creates a portable environemnt to build this project.
# Do not push this image to Docker hub.
builder:
  build: Dockerfile.builder
  image: portal-backend-builder
  pre:
    - echo "Building portal backend builder image"
  post:
    - echo "Finished building portal backend builder image"
    - echo "Building project..."
    - docker run --rm -v $WORKSPACE:/build/ -v $HOME/.m2:/home/build/.m2/ portal-backend-builder:latest
    - echo "Finished building project"
  test:
    - ./tests/test-build.sh

portal-backend:
  build: Dockerfile
  image: hbpmip/portal-backend
  pre:
    - echo "Building portal-backend image"
  post:
    - echo "Finished building portal-backend image"
  test:
    - ./tests/pre-test-run.sh
    - ./tests/test-run.sh
    - ./tests/post-test-run.sh
