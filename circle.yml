machine:
  services:
    - docker
dependencies:
  pre:
    - curl -sL https://github.com/harbur/captain/releases/download/v0.0.1/captain > ~/bin/captain
    - chmod u+x ~/bin/captain
test:
  override:
    - ./test.sh
deployment:
  hub:
    branch: master
    commands:
      - set +x
      - docker login -u $DOCKER_HUB_USER -p $DOCKER_HUB_PASS -e $DOCKER_HUB_EMAIL
      - set -x
      - captain push --branch-tags=false --commit-tags=true
  automerge:
    branch: master
    commands:
      - git fetch hub stable
      - git checkout stable
      - git pull hub master
      - git push hub stable
      - set +x
      - mvn sonar:sonar -Dsonar.login=$SONAR_KEY
      - set -x
